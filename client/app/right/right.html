<div class="panel-title-container">
    <span class="rpanel-header-heading" translate>Files</span>

    <div id="add_new_file" class="rpanel-header-heading__files cursor_pointer">
        <i class="fa fa-upload"></i>
        <span translate>Upload File</span>
        <input type="file"
               id="file_list_button"
               class="cursor_pointer file_upload_btn float-right"
               onclick="this.value=null"
               data-ng-file-select="onFileSelect($files);"
               defaultValue="File"/>
    </div>
</div>


<div class="rpanel-body" infinite-scroll-bottom="">
    <div class="rpanel-header-toolbar">

        <!--    FILE SEARCH INPUT BOX   -->
        <div class="rpanel-body-search add-on-group">
            <span class="add-on-left">
                <i class="fa fa-search"></i>
            </span>

            <input type="text"
                   class="form-control rpanel-body-search__input search-input"
                   placeholder="{{ 'Search by title' | translate }}"
                   data-ng-model="fileRequest.keyword">
            <span class="add-on-right cursor_pointer" ng-click="isAdvancedOptionCollapsed = !isAdvancedOptionCollapsed">
                <i class="fa fa-sliders"></i>
            </span>
        </div>

        <!--    ADVANCED SEARCH OPTION  -->
        <div class="advanced-search-option-container" collapse="isAdvancedOptionCollapsed">

            <!--   CHAT ROOM  -->
            <div class="advanced-search-option__category">
                <div class="advanced-search-option__title">
                    <span translate>Location</span>
                </div>

                <select ng-model="sharedEntitySearchQuery"
                        ng-options="channel as channel|getFirstLastNameOfUser group by channel.type for channel in selectOptions">
                    <option value="">{{ '@option-all-locations' | translate }}</option>
                </select>

            </div>

            <!--   FILE WRITER  -->
            <div class="advanced-search-option__category">
                <div class="advanced-search-option__title">
                    <span translate>Writer</span>
                </div>

                <select ng-model="fileRequest.writerId"
                        ng-options="user.id as user|getFirstLastNameOfUser for user in userList">
                    <option value="">{{ '@option-all-writers' | translate }}</option>
                </select>

            </div>

            <!--    FILE TYPE  -->
            <div class="advanced-search-option__category">
                <div class="advanced-search-option__title">
                    <span translate>File Type</span>
                </div>
                <select ng-model="fileRequest.fileType"
                        ng-options="type|upperFirstCharacter for type in fileTypeList"></select>
            </div>

        </div>
    </div>

    <div class="rpanel-body-content file-list" >

        <div class="file-list__item cursor_pointer" data-ng-repeat="file in fileList"
             ui-sref="files({ userName: file.writer.name, itemId: file.id })" >

            <!--    IMAGE THUMBNAIL -->
            <img class="msg-file-body__img cursor_pointer pull-left"
                 data-ng-show="(file.content.type).indexOf('image') !== -1"
                 data-ng-src="{{ server_uploaded+file.content.extraInfo.smallThumbnailUrl }}"
                 data-ui-sref="files({ userName: file.writer.name, itemId: file.id })"/>

            <!--    IF NOT IMAGE TYPE, SHOW FILE TYPE PREVIEW   -->
            <div class="msg-file-body__thumbnail pull-left"
                 data-ng-if="(file.content.type).indexOf('image') == -1">
                <div class="fileicon fileicon_{{ file.content.type | filetype | lowercase}}"></div>
            </div>


            <!-- FILE TYPE ICON IMAGE && FILE TYPE && FILE SIZE CONTAINER ON THE LEFT -->
            <div class="file-item-type hidden">
                <div class="fileicon fileicon_{{ file.content.type | filetype | lowercase }}"></div>
            </div>

            <!-- OTHER INFORMATION ABOUT FILE: TITLE, UPLOADED TIME, SHARED CHANNELS, LINK TO NEW TAB -->
            <div class="file-item-body">

                <!-- FILE AUTHOR(FILE UPLOADER) AND UPLOADED TIME-->
                <!-- TODO: implement or link 'onUserClick()'    -->
                <div class="file-item-body__author__time">
                    <span data-ng-click="onUserClick(file.writer);"
                          class="file-item-body-author cursor_pointer">
                        {{file.writer|getFirstLastNameOfUser }}
                    </span>
                    <span class="file-item-meta__createtime">{{ file.createTime | date: 'yyyy/MM/dd    h:mm a' }}</span>

                </div>

                <!-- FILE TITLE -->
                <div class="file-item-body__title">
                    <span class="file-item-body-title">
                        {{ file.content.title }}
                    </span>
                </div>

                <!--    DROPDOWN MENU   -->
                <div class="file-item-body-title__more" dropdown ng-click="$event.stopPropagation();">
                    <span class="dropdown-toggle">
                        <i class="fa fa-bars"></i>
                    </span>
                    <ul class="dropdown-menu grey_dropdown file_action_dropdown" role="menu">
                        <li class="cursor_pointer">
                            <a data-ng-click="onClickShare(file);">
                                <i class="fa fa-share-alt"></i>
                                <span translate>Share</span>
                            </a>
                        </li>
                        <li class="cursor_pointer">
                            <a data-ng-click="">
                                <i class="fa fa-comment-o"></i>
                                <span translate>Comment</span>
                            </a>
                        </li>
                        <li class="cursor_pointer">
                            <a href="{{ server_uploaded + file.content.fileUrl }}" download="{{ file.content.name }}">
                                <i class="fa fa-download"></i>
                                <span translate>Download</span>
                            </a>
                        </li>
                    </ul>
                </div>


                <!--    UPLOADED TIME, SHARED CHANNELS/PRIVATEGROUPS, LINK
                        CURRENTLY HIDDEN    -->
                <div class="file-item-meta file-item-meta__listview hidden">

                    <div data-ng-if="file.shared.length" class="file-item-meta__info">
                        Shared in
                        <span data-ng-repeat="sharedEntity in filteredSharedFile = (file.shared | filter : {type:'!user'}) track by $index">
                            <span data-ng-hide="($index === 0)">, </span>
                            <span class="file-item-meta__shared cursor_pointer" data-ng-click="onClickSharedEntity(sharedEntity.id)">
                                {{ sharedEntity.prefix }}{{ sharedEntity.name }}
                            </span>
                            <a class="link-remove link-unshare cursor_pointer" data-ng-click="onClickUnshare(file, sharedEntity)">
                                <i class="fa fa-minus-circle"></i>
                            </a>
                        </span>
                        <span data-ng-show="file.shared.length != filteredSharedFile.length">
                            <span data-ng-show="filteredSharedFile.length != 0"> and </span>with users.
                        </span>
                    </div>

                    <div class="file-item-meta__empty file-item-meta__info" data-ng-hide="file.shareEntities.length != 0">
                        <span translate>File has not been shared in any other channels</span>
                    </div>

                    <div class="file-item-meta-open file-item-meta__info">
                        <a class="file-item-meta-open__public cursor_pointer" href="{{ server_uploaded + file.content.fileUrl }}" target="{{ server_uploaded + file.content.fileUrl }}">
                            <span translate>Open original</span>
                        </a>
                    </div>

                </div>
            </div>
        </div>

        <div class="file-list__item loading" ng-if="isScrollLoading">
            <div class="loading_container_background scroll_loading_container_background" ng-if="isLoading"></div>
            <div class="loading_bg scroll_loading_bg"></div>
            <div class="loading_bar scroll_loading_bar"></div>
        </div>

        <div ng-show="fileList.length==0">
            <div ng-if="fileRequest.keyword == ''" class="rpanel-body-content__result-msg">
                <span translate>No files uploaded</span>
            </div>
            <div ng-if="fileRequest.keyword != ''" class="rpanel-body-content__result-msg">
                <span translate>No files found matching on</span> <strong>{{ fileRequest.keyword }}</strong>
            </div>
        </div>

        <div class="loading_container file" ng-if="isLoading">
            <div class="loading_container_background file" ng-if="isLoading"></div>
            <div class="loading_bg file"></div>
            <div class="loading_bar file"></div>
        </div>

    </div>
</div>
