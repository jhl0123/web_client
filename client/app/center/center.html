<!-- <input type="button" ng-click="gdClick($event)" value="google drive integration" />
  <input type="button" ng-click="dbClick($event)" value="drop box integration" /> -->
<div ng-if="false">
  <span translate>@web-notification-title</span>
  <span translate>@web-notification-body-messages-pre</span>
  <span translate>@web-notification-body-messages-post</span>
  <span translate>@web-notification-body-topic-pre</span>
  <span translate>@web-notification-body-topic-mid</span>
  <span translate>@web-notification-body-topic-post</span>
</div>

<entity-header></entity-header>

<!--    WRAPPING DIV FOR FILE DRAG&DROP -->
<div dragdown-area ng-file-drop="onFileSelect($files);" hide-on-drop-not-available="false" ng-multiple="true">
  <div class="dnd-hover-msg">
    <span translate>@dnd-file-upload-msg</span>
    <div class="background"></div>
  </div>

  <div class="file-upload-progress-container" ng-if="curUpload.status != null"
       ng-class="{'isAborted':curUpload.isAborted || curUpload.hasError,
                  'file-upload-done': curUpload.status == 'done'}">
    <!--    'uploading'     -->
    <span translate ng-if="curUpload.status == 'uploading'">@common-file-upload-progress-msg</span>
    <!--    'aborted'       -->
    <span translate ng-if="curUpload.isAborted">@common-file-upload-abort-msg</span>
    <!--    'done'      -->
    <span translate ng-if="curUpload.status == 'done'">@common-file-upload-done-msg</span>
    <!--    'error'     -->
    <span translate ng-if="curUpload.status == 'error'">@common-api-error-msg</span>


    <!--    file title  -->
    <span class="file-upload-progress-title">[{{curUpload.title}}]</span>
    <!--    progress in percentile  -->
    <span class="file-upload-progress-completion-percent">{{curUpload.progress}}%</span>
    <!--    progress file index  -->
    <span class="file-upload-progress-file-index">({{curUpload.cFileIndex}} of {{curUpload.lFileIndex}})</span>
    <!--    'cancel'    -->
    <span class="file-upload-progress-abort pull-right cursor_pointer" ng-click="onFileUploadAbortClick();" data-ng-if="curUpload.status=='uploading'">cancel</span>
    <!--    'x' icon    -->
    <span class="file-upload-progress-icon-cancel pull-right cursor_pointer" data-ng-click="onFileIconCloseClick();" data-ng-if="curUpload.status!='uploading'"><i class="icon-cancel"></i></span>

    <progressbar class="progress-striped jandi-file-upload-progress-bar active" max="100" value="curUpload.progress"></progressbar>

  </div>

  <div class="msgs-inner__border"></div>
  <article class="msgs" id="msgs-container" when-scrolled="loadMore()" scroll-glue>
    <div class="msgs__loading icon-loading"
         ng-show="msgLoadStatus.loading"
         ng-class="{'initial': loadMoreCounter < 1 || forceShowProgress}"></div>

    <div class="msgs-holder opac-zero" id="msgs-holder">
      <div class="msgs-group" data-ng-repeat="(day, msgs) in groupMsgs">

        <date-divider></date-divider>

        <div last-detector=""
             id="{{msg.id}}"
             data-length="{{msgs.length}}"
             class="msg-item"
             data-ng-repeat="msg in msgs | orderBy: 'time':false"
             data-link-id="{{ msg.id }}"
             data-link-status="{{msg.status}}"
             data-message-id="{{msg.message.id}}"
             data-message-type="{{msg.message.contentType}}"
             data-feedback-id="{{msg.feedbackId}}"
             data-event-type="{{msg.eventType}}"
             data-ng-class="{ 'text': msg.message.isText,
                              'file-upload': msg.message.isFile,
                              'comment-title': msg.message.commentOption.isTitle,
                              'comment-continue': msg.message.commentOption.isContinue,
                              'system-event-msg' : msg.message.contentType === 'systemEvent',
                              'archived-file': msg.message.status === 'archived' }">

          <system-event ng-if="msg.message.contentType === 'systemEvent'"></system-event>
          <text ng-if="msg.message.isText"></text>
          <file-uploaded ng-if="msg.message.isFile"></file-uploaded>
          <title-comment ng-if="msg.message.contentType === 'comment'"></title-comment>
        </div>

      </div>

      <!--  WHEN THERE ARE NO MESSAGES OTHER THAN SYSTEM EVENT MESSAGE. -->
      <center-help-message-container ng-if="hasNoMessage" status="emptyMessageStateHelper"></center-help-message-container>
    </div>

  </article>

  <div class="scroll-to-bottom-container cursor_pointer" ng-if="hasScrollToBottom && !hasNewMsg" ng-click="onScrollToBottomIconClicked();"
       tooltip="{{'@go-to-latest-message-msg' | translate}}" tooltip-placement="left">
    <i class="icon-down scroll-to-bottom-icon"></i>
  </div>

  <!-- chat input box -->
  <center-chat-input-box></center-chat-input-box>


</div>

<div ng-if="false">
  <!--  User Thumbnail || System event message on left of the message-->

  <div class="msg-item-float cursor_pointer" data-ng-if="( !msg.message.commentOption.isContinue )" data-ng-click="onUserClick(msg.fromEntity);"
       ng-switch="msg.message.contentType"
       ng-class="{'center-panel-disabled-member' : isDisabledMember(msg.message.writer) || isDisabledMember(msg.fromEntity) }">


    <!--    FILE    -->
    <img on-image-load class="user-profile user-thumb" ng-switch-when="file"
         ng-src="{{ msg.fromEntity | getSmallThumbnail }}"/>

    <!--    DEFAULT   -->
    <img on-image-load class="user-profile user-thumb" ng-switch-default
         ng-src="{{ msg.message.writer | getSmallThumbnail }}"/>
  </div>

  <!--    HEADER PART -->
  <!--    DISPLAYS WRITER WHEN IT IS NOT TITLE COMMENT    -->
  <!--    WHEN IT IS TITLE COMMENT, APPLIES DIFFERENT CSS FORMAT  -->
  <div class="msg-item-header"
       ng-class="{'center-panel-disabled-member' : isDisabledMember(msg.message.writer) || isDisabledMember(msg.fromEntity) }">
    <!--    WRITER
            IF IT IS TITLE COMMENT, HIDE WRITER NAME FROM HEADER    -->
            <span class="msg-item-header__name cursor_pointer" data-ng-click="onUserClick(msg.fromEntity);"
                  ng-hide="!msg.message.commentOption.isTitle && msg.message.contentType === 'comment'">
              <span class="msg-item-header__nameSpace">
                <span ng-if="msg.message.contentType !== 'file'"> {{msg.message.writer|getName}}</span>
                <span ng-if="msg.message.contentType === 'file'"> {{msg.fromEntity|getName}}</span>
              </span>

              <!--    CREATED TIME    -->
              <span class="msg-item-header__created">
                {{msg.time | gethmmaFormat }}
              </span>

              <span class="badge unread-badge">{{ msg.unreadCount }}</span>
            </span>

    <!--    CONTINUED COMMENT ON SAME FILE  -->
            <span class="continue-comment-body" ng-if="!msg.message.commentOption.isTitle && msg.message.contentType === 'comment'">
              <!--    COMMENT CONTENT -->
              <p>
                <!--    WRITER  -->
                <span class="msg-item-header__name cursor_pointer" data-ng-click="onUserClick(msg.fromEntity);"
                      ng-class="{'center-panel-disabled-member' : isDisabledMember(msg.message.writer) || isDisabledMember(msg.fromEntity) }">
                  <span ng-if="msg.message.contentType !== 'file'"> {{msg.message.writer|getName}} </span>
                  <span ng-if="msg.message.contentType === 'file'"> {{msg.fromEntity|getName}} </span>
                </span>

                <!--    CONTENT(MESSAGE)    -->
                <span class="keep" data-ng-bind-html="(msg.message.content.body) || ''"></span>

                <!--    CREATED TIME    -->
                <span class="msg-item-header__created">
                  {{msg.time | gethmmaFormat}}
                </span>
                <span class="badge unread-badge">{{ msg.unreadCount }}</span>

              </p>
            </span>
    <!--    DELETE ICON APPEARS ON HOVER    -->
    <a class="msg-item__action link-remove pull-right cursor_pointer"
       data-ng-if="( member.id === msg.fromEntity &&  msg.message.contentType === 'text' )"
       data-ng-click="deleteMessage(msg)"
       tooltip="{{ '@message-delete' | translate }}">
      <i class="icon-cancel"></i>
    </a>
  </div>
  <div class="msg-item-body">

    <!-- TEXT -->
    <div class="msg-text" data-ng-if="msg.message.contentType === 'text'">
      <p class="msg-text-body keep" data-ng-bind-html="(msg.message.content.body) || ''"></p>
    </div>

    <!-- FILE -->
    <div class="msg-file" ng-cloak data-ng-if="msg.message.contentType === 'file'">

      <!--  FILE PREVIEW IMAGE  -->
      <div class="msg-file-body-float pull-left" data-ng-click="onSmallThumbnailClick($event, msg);">
        <!--  FILE NOT ARCHIVED -->
        <div ng-if="msg.message.status != 'archived'">
          <!--    IMAGE THUMBNAIL -->
          <div class="image_wrapper">
            <img rotate rotate-left-align="true"
                 class="msg-file-body__img cursor_pointer"
                 data-ng-show="msg.message.content.filterType.indexOf('image') !== -1"
                 data-ng-src="{{ server_uploaded+msg.message.content.extraInfo.smallThumbnailUrl }}"
              />
          </div>

          <div ng-if="msg.message.content.filterType.indexOf('image') !== -1 &&  isIE9" class="ie9-image-rotator cursor_pointer"
               ng-click="onImageRotatorClick($event);">
            <i id="fromCenterLargeThumbnail" class="fa fa-rotate-right"></i>
          </div>

          <!--    FILE TYPE THUMBNAIL -->
          <div class="msg-file-body__thumbnail"
               data-ng-if="msg.message.content.filterType.indexOf('image') == -1">
            <div class="fileicon fileicon-{{msg.message.content.type | getFileIconImage | lowercase}}" ></div>

          </div>
        </div>

        <!--  ARCHIVED FILE -->
        <div ng-if="msg.message.status == 'archived'">
          <!--    FILE TYPE THUMBNAIL -->
          <div class="msg-file-body__thumbnail">
            <img class="fileicon" ng-src="assets/images/fileicon_archived.png"/>
          </div>
        </div>
      </div>

      <!--  FILE INFO -->
      <div class="msg-file-meta">

        <div class="msg-file-meta-up">

          <!--  NOT ARCHIVED FILE -->
          <div ng-if="msg.message.status != 'archived'">
            <!--    TITLE   -->
            <a class="msg-file-meta__title file__name break-word"
               ui-sref="files({ userName: msg.message.writer.name, itemId: msg.message.id })">
              {{ msg.message.content.title }}
            </a>

            <span class="bullet">•</span>

            <!--    SIZE AND FILE TYPE  -->
                  <span class="msg-file-meta-info">
                    {{msg.message.content.size | bytes }} {{ msg.message.content | fileType }}
                  </span>
          </div>

          <!--  ARCHIVED FILE -->
          <div class="archived-file-title" ng-if="msg.message.status == 'archived'">
            <a class="msg-file-meta__title file__name"
               ui-sref="files({ userName: msg.message.writer.name, itemId: msg.message.id })">
              <span translate>@common-deleted-file-title</span>
            </a>

          </div>
        </div>

        <div ng-if="msg.message.status != 'archived'" class="msg-file-meta-down">
          <!--    SHARED MESSAGE  -->
                  <span class="msg-file-meta-info">
                    <span data-ng-if="( msg.id !== msg.message.writer.id )">
                      <a class="msg-file-meta__writer file__owner">{{msg.message.writer|getName}}</a>
                      <span translate>@msg-whose</span>
                    </span>
                    <span ng-if="msg.status == 'shared'" translate>@msg-shared</span>
                    <span ng-if="msg.status == 'unshared'" translate>@msg-unshared</span>
                    <span translate>@msg-file</span>
                  </span>

          <span class="bullet">•</span>

          <!--    SHARED ENTITIES -->
                  <span data-ng-if="msg.message.shared.length">
                    <span data-ng-repeat="sharedEntity in filteredSharedFile = (msg.message.shared | filter: {type:'!user'}) track by $index">
                      <span data-ng-hide="($index === 0)">, </span>
                      <span class="file-item-meta__shared cursor_pointer" data-ng-click="onClickSharedEntity(sharedEntity.id)">
                        {{ sharedEntity.prefix }}{{ sharedEntity.name }}
                      </span>
                      <a class="link-remove link-unshare cursor_pointer" data-ng-click="onClickUnshare(msg.message, sharedEntity)">
                        <i class="fa fa-minus-circle"></i>
                      </a>
                    </span>

                    <span ng-show="msg.message.shared.length != filteredSharedFile.length" ng-if="false">
                      <span ng-show="filteredSharedFile.length != 0"> and </span>with users
                    </span>

                    <span class="bullet">•</span>
                  </span>

          <!-- OPEN ORIGINAL  -->
          <a class="cursor_pointer" href="{{ server_uploaded + msg.message.content.fileUrl }}" target="{{ server_uploaded + msg.message.content.fileUrl }}">
            <span translate>@msg-open-original</span>
          </a>

          <span class="bullet">•</span>

          <!--    DOWNLOAD    -->
          <a class="cursor_pointer" href="{{ server_uploaded +'download/' + msg.message.content.fileUrl }}" download="{{ msg.message.content.title  }}">
            <span translate>@common-download</span>
          </a>

          <span class="bullet">•</span>

          <!--    COMMENT -->
          <a class="cursor_pointer"  data-ng-click="setCommentFocus(msg.message);">
            <span translate>@btn-comment</span>
          </a>

          <span class="bullet">•</span>

          <!--    SHARE   -->
          <a class="cursor_pointer" data-ng-click="onShareClick(msg.message);">
            <span translate>@btn-share</span>
          </a>


        </div>
      </div>
    </div>

    <!--    COMMENT
            최초 댓글
            DISPLAY COMMENT BODY WHEN IT IS TITLE
            IF CURRENT COMMENT IS NOT TITLE, CONTENT GETS DISPLAYED WITHIN HEADER -->
    <div class="msg-comment" data-ng-if="msg.message.contentType === 'comment' && msg.message.commentOption.isTitle"
         ng-class="{  'msg-comment-with-thumbnail': msg.message.commentOption.isTitle,
                              'archived-file-with-comment': msg.feedback.status=='archived'}">

      <!--    LEFT PART OF BODY CONTENT
              IMAGE/FILE THUMBNAIL    -->
      <div class="msg-file-body-float pull-left"
           ng-class="{'cursor_pointer': msg.message.contentType !== 'comment'}"
           data-ng-click="onSmallThumbnailClick($event, msg);">

        <div ng-if="msg.feedback.status != 'archived'">
          <!--    IMAGE THUMBNAIL -->
          <div class="image_wrapper">
            <img rotate rotate-left-align="true"
                 class="msg-file-body__img cursor_pointer"
                 data-ng-show="msg.feedback.content.filterType.indexOf('image') !== -1 && msg.message.commentOption.isTitle && msg.feedback.status != 'archived'"
                 data-ng-src="{{ server_uploaded+msg.feedback.content.extraInfo.smallThumbnailUrl }}"/>
          </div>

          <!--    FILE THUMBNAIL  -->
          <div class="msg-file-body__thumbnail"
               data-ng-if="msg.feedback.content.filterType.indexOf('image') == -1 && msg.message.commentOption.isTitle">
            <div class="fileicon fileicon-{{msg.feedback.content.type | getFileIconImage | lowercase}}" ></div>

          </div>
        </div>

        <div class="msg-file-body__thumbnail" ng-if="msg.feedback.status == 'archived'">
          <img class="fileicon" ng-src="assets/images/fileicon_archived.png"/>
        </div>

        <!--    COMMENT ICON    -->
        <i class="fa fa-comment"></i>


      </div>

      <!--    RIGHT PART OF BODY CONTENT  -->
      <div class="msg-file-meta">
        <div class="msg-comment-header" data-ng-if="( msg.message.commentOption.isTitle )">
          Commented on

          <!--    FILE TITLE/NAME  -->
          <div ng-if="msg.feedback.status != 'archived'">
            <a class="msg-file-meta__title file__name break-word" ui-sref="files({ userName: msg.feedback.writer.name, itemId: msg.feedback.id })">
              {{msg.feedback.content.title || msg.feedback.content.name}}
            </a>
          </div>

          <div ng-if="msg.feedback.status == 'archived'">
            <a class="archived-msg-file-meta__title" ui-sref="files({ userName: msg.feedback.writer.name, itemId: msg.feedback.id })">
              <span translate>@common-deleted-file-title</span>
            </a>
          </div>
        </div>
      </div>

      <!--    COMMENT MESSAGE -->
      <div class="msg-comment-body">

        <p>
          <!--    WRITER  -->
                  <span class="msg-item-header__name cursor_pointer" data-ng-click="onUserClick(msg.fromEntity);"
                        ng-class="{'center-panel-disabled-member' : isDisabledMember(msg.message.writer) || isDisabledMember(msg.fromEntity) }">
                    <span ng-if="msg.message.contentType !== 'file'"> {{msg.message.writer|getName}} </span>
                    <span ng-if="msg.message.contentType === 'file'"> {{msg.fromEntity|getName}}</span>
                  </span>

          <span class="keep" data-ng-bind-html="(msg.message.content.body) || ''"></span>

                  <span class="msg-item-header__created">
                    {{msg.time | gethmmaFormat}}
                  </span>

        </p>

      </div>

    </div>


  </div>
</div>